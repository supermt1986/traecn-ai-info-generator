# CloudFlare平台AI平台管理系统开发需求

## 1. 总体说明

开发一个基于CloudFlare Workers部署的Web程序，使用CloudFlare D1作为数据库。前端需确保风格简洁、美观，并自适应PC端及移动端访问。

## 2. 技术选型

- **部署平台**：CloudFlare Workers
- **数据库**：CloudFlare D1
- **前端技术**：建议React/Vue + TailwindCSS等响应式UI库
- **后端语言**：JavaScript/TypeScript

## 3. 功能需求

### 3.1 登录功能

- 提供登录页面，界面简洁。  
- 仅支持内置用户：  
    - 用户名：admin  
    - 密码：passwd1234
- 登录成功后进入主页面，失败提示错误。

### 3.2 平台与Agent管理功能

#### 3.2.1 平台信息管理

- 新增/编辑/删除平台账号。  
- 字段要求：  
    - **平台名称**（字符串）  
    - **ApiBaseUrl**（字符串）  
    - **apiKey**（字符串）  
    - **Model**（字符串，支持多个模型，英文逗号分隔）

#### 3.2.2 Agent信息管理

- 新增/编辑/删除Agent。  
- 字段要求：  
    - **Agent名**（字符串）  
    - **环境变量**（字符串），键名自定义，键值可引用 `$BASE_URL`、`$API_KEY`、`$MODEL` 等占位符

### 3.3 AI信息生成与测试

#### 3.3.1 交互流程

- 用户进入“AI信息生成”页面后，可按如下流程操作：

#### 3.3.2 字段与交互

- **平台**（下拉选择）  
    - 支持从已登录平台中选择
    - 选择后自动读取并展示 apiBaseUrl、apiKey

- **模型**（下拉选择）  
    - 支持从该平台配置的模型列表动态展示
    - 选择后，自动完成两项操作：  
        - 自动生成符合 OpenAI 标准的 API 测试命令并在页面展示
        - 显示“测试”按钮

- **API测试按钮**  
    - 点击后自动调用 openapi 接口（即用刚才生成的 API 命令参数实际发起请求）
    - 调用结果在页面上实时展示，便于用户检验 API 是否正常返回及其具体内容

- **Agent**（下拉选择）  
    - 支持从已配置 Agent 中选择
    - 选择后，根据 Agent 的环境变量模板，自动生成实际值（用当前选择的平台的 apiBaseUrl、apiKey、Model 替换 `$BASE_URL`、`$API_KEY`、`$MODEL`）

#### 3.3.3 API测试功能

- 显示自动生成的 OpenAI 标准 API 测试命令
- 提供“执行”按钮，一键调用 API，返回并展示结果

## 4. UI需求

- 整体风格简洁、现代
- 所有表单及下拉均需适配PC及手机屏幕
- 主色调及字体建议遵循Material Design或Ant Design配色规范
- 响应式布局，重视用户体验

## 5. 安全性

- 所有敏感 apiKey 等参数仅限已登录用户可见
- 登录态可优先用 Session/Cookie，也可利用 CloudFlare Worker KV 做登录状态管理

## 6. 自动化部署要求

- 项目开发完成后，实现自动化部署流程，要求：
    - 自动调用命令行工具 `wrangler` 登录 Cloudflare 账号
    - 成功登录后，自动执行 `wrangler deploy` 完成程序的 Cloudflare Workers 部署
    - 若有自定义 D1 数据库迁移/初始化命令，同步在部署流程中自动执行
    - 部署日志需在控制台输出，便于开发者确认流程执行状态

## 7. 说明与备注

- 本程序建议仅内网/自用部署，如需多用户、多权限管理请后续需求细化
- Agent 的环境变量引用方式为 `$BASE_URL`、`$API_KEY`、`$MODEL`，允许兼容更多占位符

